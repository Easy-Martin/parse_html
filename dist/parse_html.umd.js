(function(x,T){typeof exports=="object"&&typeof module<"u"?module.exports=T():typeof define=="function"&&define.amd?define(T):(x=typeof globalThis<"u"?globalThis:x||self,x.parse_html=T())})(this,(function(){"use strict";const x=["img","br","input","meta","link","hr","area","base","col","embed","param","source","track","wbr"];function T(o){return o.replace(/[A-Z]/g,t=>`-${t.toLowerCase()}`)}function L(o){return o.replace(/-([a-z])/g,(t,e)=>e.toUpperCase())}function I(o){const t={};if(!o)return t;const e=/([a-zA-Z0-9-]+)\s*=\s*(?:"([^"]*)"|'([^']*)'|([^\s>]+))/g;let n;for(;(n=e.exec(o))!==null;){const[,s,r,l,a]=n,h=r||l||a||"";t[s]=h}if(t.style){const s={},r=/([a-zA-Z0-9-]+)\s*:\s*([^;]+)/g;let l;for(;(l=r.exec(t.style))!==null;){const[,a,h]=l;s[L(a.trim())]=h.trim()}t.styleObj=s,delete t.style}return t}function c(o){if(o=o,!o)return null;if(!o.startsWith("<"))return{tagName:"#text",textContent:o,attributes:{},styles:{},children:[],parent:null};const t=/<([a-zA-Z0-9]+)\s*(.*?)\/?>/,e=o.match(t);if(e){const[,f,i]=e;if(x.includes(f.toLowerCase())){const y=I(i);return{tagName:f.toLowerCase(),attributes:y,styles:y.styleObj||{},textContent:"",children:[],parent:null}}}const n=/<([a-zA-Z0-9]+)\s*(.*?)>/,s=o.match(n);if(!s)return null;const[r,l,a]=s,h=l.toLowerCase(),u=`</${h}>`;let w=-1,d=1,p=r.length;for(;p<o.length&&d>0;){const f=o.indexOf(`<${h}`,p),i=o.indexOf(u,p);if(i===-1)break;f!==-1&&f<i?(d++,p=f+`<${h}`.length):(d--,d===0&&(w=i),p=i+u.length)}const M=w!==-1?o.slice(r.length,w):o.slice(r.length),A=I(a),N={tagName:h,attributes:A,styles:A.styleObj||{},textContent:"",children:[],parent:null};if(M){const f=[];let i=M;for(;i;){const y=i.indexOf("<");if(y===-1){const m=c(i);m&&f.push(m),i=""}else if(y>0){const m=c(i.slice(0,y));m&&f.push(m),i=i.slice(y)}else{const m=i.match(n);if(!m){const g=c(i);g&&f.push(g),i="";continue}const $=m[1].toLowerCase(),O=`</${$}>`;if(x.includes($)){const g=c(i.slice(0,m[0].length));g&&f.push(g),i=i.slice(m[0].length);continue}let j=-1,S=1,E=m[0].length;for(;E<i.length&&S>0;){const g=i.indexOf(`<${$}`,E),b=i.indexOf(O,E);if(b===-1)break;g!==-1&&g<b?(S++,E=g+`<${$}`.length):(S--,S===0&&(j=b),E=b+O.length)}if(j!==-1){const g=i.slice(0,j+O.length),b=c(g);b&&f.push(b),i=i.slice(j+O.length)}else{const g=c(i);g&&f.push(g),i=""}}}N.children=f.filter(Boolean),N.children.length===1&&N.children[0].tagName==="#text"&&(N.textContent=N.children[0].textContent,N.children=[])}return N}function k(o){if(o=o,!o)return[];const t=[];let e=o;for(;e;){const n=e.indexOf("<");if(n===-1){const s=c(e);s&&t.push(s),e=""}else if(n>0){const s=c(e.slice(0,n));s&&t.push(s),e=e.slice(n)}else{const s=/<([a-zA-Z0-9]+)\s*(.*?)>/,r=e.match(s);if(!r){const a=c(e);a&&t.push(a),e="";continue}const l=r[1].toLowerCase();if(x.includes(l)){const a=/<([a-zA-Z0-9]+)\s*(.*?)\/?>/,h=e.match(a);if(h){const u=c(h[0]);u&&t.push(u),e=e.slice(h[0].length)}else{const u=c(e);u&&t.push(u),e=""}}else{const a=`</${l}>`;let h=-1,u=1,w=r[0].length;for(;w<e.length&&u>0;){const d=e.indexOf(`<${l}`,w),p=e.indexOf(a,w);if(p===-1)break;d!==-1&&d<p?(u++,w=d+`<${l}`.length):(u--,u===0&&(h=p),w=p+a.length)}if(h!==-1){const d=e.slice(0,h+a.length),p=c(d);p&&t.push(p),e=e.slice(h+a.length)}else{const d=c(e);d&&t.push(d),e=""}}}}return t.filter(Boolean)}class C{constructor(t){if(typeof t!="string")throw new Error("初始化Node必须传入HTML字符串");const e=t;if(!e)throw new Error("无法解析空的HTML字符串");const n=c(e),s=k(e);if(this.tagName="",this.attributes={},this.styles={},this.textContent="",this.children=[],this.parent=null,n&&s.length===1)this.tagName=n.tagName,this.attributes={...n.attributes},this.styles={...n.styles},this.textContent=n.textContent||"",n.children.length>0&&(this.children=n.children.map(r=>{const l=new C(this.#t(r));return l.parent=this,l}));else if(s.length>0)this.tagName="#fragment",this.attributes={},this.styles={},this.textContent="",this.children=s.map(r=>{const l=new C(this.#t(r));return l.parent=this,l});else throw new Error("无法解析无效的HTML字符串")}#t(t){if(t.tagName==="#text")return t.textContent;let e=`<${t.tagName}`;const n={...t.attributes};if(Object.keys(t.styles).length>0){const r=Object.entries(t.styles).map(([l,a])=>`${T(l)}: ${a}`).join("; ");n.style=r}for(const[r,l]of Object.entries(n))r!=="styleObj"&&typeof l=="string"&&(e+=` ${r}="${l}"`);if(x.includes(t.tagName))return e+="/>",e;e+=">";let s=t.textContent;return t.children.length>0&&(s+=t.children.map(r=>this.#t(r)).join("")),`${e}${s}</${t.tagName}>`}child(){return[...this.children]}before(t){if(!this.parent)throw new Error("当前节点没有父节点，无法执行before操作");const e=this.#e(t),n=this.parent.children.findIndex(s=>s===this);if(n===-1)throw new Error("当前节点不在父节点的子节点列表中");return this.parent.children.splice(n,0,e),e.parent=this.parent,this}after(t){if(!this.parent)throw new Error("当前节点没有父节点，无法执行after操作");const e=this.#e(t),n=this.parent.children.findIndex(s=>s===this);if(n===-1)throw new Error("当前节点不在父节点的子节点列表中");return this.parent.children.splice(n+1,0,e),e.parent=this.parent,this}insert(t,e){if(typeof t!="number"||t<0||t>this.children.length)throw new Error(`插入位置${t}无效，必须是0到${this.children.length}之间的整数`);const n=this.#e(e);return n.tagName==="#fragment"?n.children.forEach((s,r)=>{s.parent=this,this.children.splice(t+r,0,s)}):(this.children.splice(t,0,n),n.parent=this),this}getAttr(t){if(this.tagName==="#fragment"||this.tagName==="#text")return null;if(typeof t!="string")throw new Error("属性名必须是字符串");return typeof this.attributes[t]=="string"?this.attributes[t]:null}setAttr(t,e){if(this.tagName==="#fragment"||this.tagName==="#text")throw new Error("片段/文本节点不支持设置属性");if(typeof t!="string")throw new Error("属性名必须是字符串");return e==null?delete this.attributes[t]:this.attributes[t]=String(e),this}setAttrs(t){if(this.tagName==="#fragment"||this.tagName==="#text")throw new Error("片段/文本节点不支持设置属性");if(typeof t!="object"||t===null)throw new Error("属性对象必须是非空对象");for(const[e,n]of Object.entries(t))this.setAttr(e,n);return this}getStyle(t){if(this.tagName==="#fragment"||this.tagName==="#text")return null;if(typeof t!="string")throw new Error("样式属性名必须是字符串");const e=L(t);return this.styles[e]||this.styles[t]||null}setStyle(t,e){if(this.tagName==="#fragment"||this.tagName==="#text")throw new Error("片段/文本节点不支持设置样式");if(typeof t!="string")throw new Error("样式属性名必须是字符串");const n=L(t);return e==null?(delete this.styles[n],delete this.styles[t]):this.styles[n]=String(e),this}setStyles(t){if(this.tagName==="#fragment"||this.tagName==="#text")throw new Error("片段/文本节点不支持设置样式");if(typeof t!="object"||t===null)throw new Error("样式对象必须是非空对象");for(const[e,n]of Object.entries(t))this.setStyle(e,n);return this}getHtml(){if(this.tagName==="#text")return this.textContent;if(this.tagName==="#fragment")return this.children.map(s=>s.getHtml()).join("");let t=`<${this.tagName}`;const e={...this.attributes};if(Object.keys(this.styles).length>0){const s=Object.entries(this.styles).map(([r,l])=>`${T(r)}: ${l}`).join("; ");e.style=s}for(const[s,r]of Object.entries(e))if(s!=="styleObj"&&typeof r=="string"){const l=r.replace(/"/g,"&quot;");t+=` ${s}="${l}"`}if(x.includes(this.tagName))return t+="/>",t;t+=">";let n=this.textContent;return this.children.length>0&&(n+=this.children.map(s=>s.getHtml()).join("")),`${t}${n}</${this.tagName}>`}#e(t){if(t instanceof C)return t;if(typeof t=="string")return new C(t);throw new Error("插入的节点必须是HTML字符串或Node实例")}}return C}));
//# sourceMappingURL=parse_html.umd.js.map
